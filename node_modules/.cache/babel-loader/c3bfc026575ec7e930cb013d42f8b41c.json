{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _canMessage = require('can-message');\n\nvar _weakmapEvent = require('weakmap-event');\n\nvar _weakmapEvent2 = _interopRequireDefault(_weakmapEvent);\n\nvar _ap = require('ap');\n\nvar _performanceNow = require('performance-now');\n\nvar _performanceNow2 = _interopRequireDefault(_performanceNow);\n\nvar _raf = require('raf');\n\nvar _raf2 = _interopRequireDefault(_raf);\n\nvar _thyming = require('thyming');\n\nvar _delay = require('./delay');\n\nvar _delay2 = _interopRequireDefault(_delay);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n} // how many messages to batch at maximum when reading as fast as we can\n\n\nvar MAX_MESSAGE_QUEUE = 5000;\nvar MessageEvent = (0, _weakmapEvent2.default)();\nvar ErrorEvent = (0, _weakmapEvent2.default)();\nvar ConnectEvent = (0, _weakmapEvent2.default)();\nvar DisconnectEvent = (0, _weakmapEvent2.default)();\n\nvar Panda = function () {\n  function Panda(options) {\n    (0, _classCallCheck3.default)(this, Panda); // setup event handlers\n\n    this.onMessage = (0, _ap.partial)(MessageEvent.listen, this);\n    this.onError = (0, _ap.partial)(ErrorEvent.listen, this);\n    this.onConnect = (0, _ap.partial)(ConnectEvent.listen, this);\n    this.onDisconnect = (0, _ap.partial)(DisconnectEvent.listen, this); // initialize device object\n\n    this.device = options.device;\n    this.device.onError((0, _ap.partial)(ErrorEvent.broadcast, this));\n    this.device.onConnect(this.connectHandler.bind(this));\n    this.device.onDisconnect(this.disconnectHandler.bind(this)); // member variables\n\n    this.paused = true;\n    this.messageQueue = []; // function binding\n\n    this.readLoop = this.readLoop.bind(this);\n    this.flushMessageQueue = this.flushMessageQueue.bind(this);\n  } // state getters\n\n\n  (0, _createClass3.default)(Panda, [{\n    key: 'isConnected',\n    value: function isConnected() {\n      return !!this.connected;\n    }\n  }, {\n    key: 'isPaused',\n    value: function isPaused() {\n      return !!this.paused;\n    } // methods\n\n  }, {\n    key: 'connect',\n    value: function () {\n      var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n        var serialNumber;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.isConnected()) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt('return', this.connected);\n\n              case 2:\n                _context.next = 4;\n                return this.device.connect();\n\n              case 4:\n                _context.next = 6;\n                return this.getSerialNumber();\n\n              case 6:\n                serialNumber = _context.sent;\n                this.connectHandler(serialNumber);\n                return _context.abrupt('return', serialNumber);\n\n              case 9:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function connect() {\n        return _ref.apply(this, arguments);\n      }\n\n      return connect;\n    }()\n  }, {\n    key: 'disconnect',\n    value: function () {\n      var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.isConnected()) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt('return', false);\n\n              case 2:\n                return _context2.abrupt('return', this.device.disconnect());\n\n              case 3:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function disconnect() {\n        return _ref2.apply(this, arguments);\n      }\n\n      return disconnect;\n    }()\n  }, {\n    key: 'start',\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3() {\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.connect();\n\n              case 2:\n                return _context3.abrupt('return', this.unpause());\n\n              case 3:\n              case 'end':\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function start() {\n        return _ref3.apply(this, arguments);\n      }\n\n      return start;\n    }()\n  }, {\n    key: 'pause',\n    value: function () {\n      var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4() {\n        var wasPaused;\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                wasPaused = this.isPaused();\n                this.paused = true;\n                return _context4.abrupt('return', !wasPaused);\n\n              case 3:\n              case 'end':\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function pause() {\n        return _ref4.apply(this, arguments);\n      }\n\n      return pause;\n    }()\n  }, {\n    key: 'resume',\n    value: function () {\n      var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5() {\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                return _context5.abrupt('return', this.unpause());\n\n              case 1:\n              case 'end':\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function resume() {\n        return _ref5.apply(this, arguments);\n      }\n\n      return resume;\n    }()\n  }, {\n    key: 'unpause',\n    value: function () {\n      var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6() {\n        var wasPaused;\n        return _regenerator2.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                wasPaused = this.isPaused();\n\n                if (wasPaused) {\n                  _context6.next = 3;\n                  break;\n                }\n\n                return _context6.abrupt('return', false);\n\n              case 3:\n                this.paused = false;\n                this.startReading();\n                return _context6.abrupt('return', wasPaused);\n\n              case 6:\n              case 'end':\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function unpause() {\n        return _ref6.apply(this, arguments);\n      }\n\n      return unpause;\n    }() // vendor API methods\n\n  }, {\n    key: 'getHealth',\n    value: function () {\n      var _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7() {\n        var buf, voltage, current, isStarted, controlsAreAllowed, isGasInterceptorDetector, isStartSignalDetected, isStartedAlt;\n        return _regenerator2.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this.vendorRequest('health', {\n                  request: 0xd2,\n                  value: 0,\n                  index: 0\n                }, 13);\n\n              case 2:\n                buf = _context7.sent;\n                voltage = buf.readUInt32LE(0) / 1000;\n                current = buf.readUInt32LE(4) / 1000;\n                isStarted = buf.readInt8(8) === 1;\n                controlsAreAllowed = buf.readInt8(9) === 1;\n                isGasInterceptorDetector = buf.readInt8(10) === 1;\n                isStartSignalDetected = buf.readInt8(11) === 1;\n                isStartedAlt = buf.readInt8(12) === 1;\n                return _context7.abrupt('return', {\n                  voltage: voltage,\n                  current: current,\n                  isStarted: isStarted,\n                  controlsAreAllowed: controlsAreAllowed,\n                  isGasInterceptorDetector: isGasInterceptorDetector,\n                  isStartSignalDetected: isStartSignalDetected,\n                  isStartedAlt: isStartedAlt\n                });\n\n              case 11:\n              case 'end':\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function getHealth() {\n        return _ref7.apply(this, arguments);\n      }\n\n      return getHealth;\n    }()\n  }, {\n    key: 'getDeviceMetadata',\n    value: function () {\n      var _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee8() {\n        var buf, serial, secret, hashSig;\n        return _regenerator2.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.next = 2;\n                return this.vendorRequest('getDeviceMetadata', {\n                  request: 0xd0,\n                  value: 0,\n                  index: 0\n                }, 0x20);\n\n              case 2:\n                buf = _context8.sent;\n                serial = buf.slice(0, 0x10); // serial is the wifi style serial\n\n                secret = buf.slice(0x10, 0x10 + 10);\n                hashSig = buf.slice(0x1c);\n                return _context8.abrupt('return', [serial.toString(), secret.toString()]);\n\n              case 7:\n              case 'end':\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function getDeviceMetadata() {\n        return _ref8.apply(this, arguments);\n      }\n\n      return getDeviceMetadata;\n    }()\n  }, {\n    key: 'getSerialNumber',\n    value: function () {\n      var _ref9 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee9() {\n        var _ref10, _ref11, serial, secret;\n\n        return _regenerator2.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return this.getDeviceMetadata();\n\n              case 2:\n                _ref10 = _context9.sent;\n                _ref11 = (0, _slicedToArray3.default)(_ref10, 2);\n                serial = _ref11[0];\n                secret = _ref11[1];\n                return _context9.abrupt('return', serial);\n\n              case 7:\n              case 'end':\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function getSerialNumber() {\n        return _ref9.apply(this, arguments);\n      }\n\n      return getSerialNumber;\n    }()\n  }, {\n    key: 'getSecret',\n    value: function () {\n      var _ref12 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee10() {\n        var _ref13, _ref14, serial, secret;\n\n        return _regenerator2.default.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _context10.next = 2;\n                return this.getDeviceMetadata();\n\n              case 2:\n                _ref13 = _context10.sent;\n                _ref14 = (0, _slicedToArray3.default)(_ref13, 2);\n                serial = _ref14[0];\n                secret = _ref14[1];\n                return _context10.abrupt('return', secret);\n\n              case 7:\n              case 'end':\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function getSecret() {\n        return _ref12.apply(this, arguments);\n      }\n\n      return getSecret;\n    }()\n  }, {\n    key: 'getVersion',\n    value: function () {\n      var _ref15 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee11() {\n        var buf;\n        return _regenerator2.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                _context11.next = 2;\n                return this.vendorRequest('getVersion', {\n                  request: 0xd6,\n                  value: 0,\n                  index: 0\n                }, 0x40);\n\n              case 2:\n                buf = _context11.sent;\n                return _context11.abrupt('return', buf.toString());\n\n              case 4:\n              case 'end':\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function getVersion() {\n        return _ref15.apply(this, arguments);\n      }\n\n      return getVersion;\n    }()\n  }, {\n    key: 'getType',\n    value: function () {\n      var _ref16 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee12() {\n        var buf;\n        return _regenerator2.default.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                _context12.next = 2;\n                return this.vendorRequest('getType', {\n                  request: 0xc1,\n                  value: 0,\n                  index: 0\n                }, 0x40);\n\n              case 2:\n                buf = _context12.sent;\n                return _context12.abrupt('return', buf.length ? buf[0] : null);\n\n              case 4:\n              case 'end':\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function getType() {\n        return _ref16.apply(this, arguments);\n      }\n\n      return getType;\n    }()\n  }, {\n    key: 'isWhite',\n    value: function () {\n      var _ref17 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee13() {\n        return _regenerator2.default.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _context13.next = 2;\n                return this.getType();\n\n              case 2:\n                _context13.t0 = _context13.sent;\n                return _context13.abrupt('return', _context13.t0 === 1);\n\n              case 4:\n              case 'end':\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function isWhite() {\n        return _ref17.apply(this, arguments);\n      }\n\n      return isWhite;\n    }()\n  }, {\n    key: 'isGrey',\n    value: function () {\n      var _ref18 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee14() {\n        return _regenerator2.default.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                _context14.next = 2;\n                return this.getType();\n\n              case 2:\n                _context14.t0 = _context14.sent;\n                return _context14.abrupt('return', _context14.t0 === 2);\n\n              case 4:\n              case 'end':\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function isGrey() {\n        return _ref18.apply(this, arguments);\n      }\n\n      return isGrey;\n    }()\n  }, {\n    key: 'isBlack',\n    value: function () {\n      var _ref19 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee15() {\n        return _regenerator2.default.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                _context15.next = 2;\n                return this.getType();\n\n              case 2:\n                _context15.t0 = _context15.sent;\n                return _context15.abrupt('return', _context15.t0 === 3);\n\n              case 4:\n              case 'end':\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n\n      function isBlack() {\n        return _ref19.apply(this, arguments);\n      }\n\n      return isBlack;\n    }()\n  }, {\n    key: 'hasObd',\n    value: function () {\n      var _ref20 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee16() {\n        return _regenerator2.default.wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.next = 2;\n                return this.getType();\n\n              case 2:\n                _context16.t0 = _context16.sent;\n                return _context16.abrupt('return', _context16.t0 > 2);\n\n              case 4:\n              case 'end':\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n\n      function hasObd() {\n        return _ref20.apply(this, arguments);\n      }\n\n      return hasObd;\n    }()\n  }, {\n    key: 'setObd',\n    value: function () {\n      var _ref21 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee17(obd) {\n        return _regenerator2.default.wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                _context17.next = 2;\n                return this.vendorWrite('setObd', {\n                  request: 0xdb,\n                  value: obd ? 1 : 0,\n                  index: 0\n                });\n\n              case 2:\n              case 'end':\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n\n      function setObd(_x) {\n        return _ref21.apply(this, arguments);\n      }\n\n      return setObd;\n    }()\n  }, {\n    key: 'setSafetyMode',\n    value: function () {\n      var _ref22 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee18(mode) {\n        return _regenerator2.default.wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                _context18.next = 2;\n                return this.vendorWrite('setSafetyMode', {\n                  request: 0xdc,\n                  value: mode,\n                  index: 0\n                });\n\n              case 2:\n              case 'end':\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n\n      function setSafetyMode(_x2) {\n        return _ref22.apply(this, arguments);\n      }\n\n      return setSafetyMode;\n    }() // i/o wrappers\n\n  }, {\n    key: 'vendorRequest',\n    value: function () {\n      var _ref23 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee19(event, controlParams, length) {\n        var result;\n        return _regenerator2.default.wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.prev = 0;\n                _context19.next = 3;\n                return this.device.vendorRequest(controlParams, length);\n\n              case 3:\n                result = _context19.sent;\n                return _context19.abrupt('return', result.data);\n\n              case 7:\n                _context19.prev = 7;\n                _context19.t0 = _context19['catch'](0);\n                ErrorEvent.broadcast(this, {\n                  event: 'Panda.' + event + ' failed',\n                  error: _context19.t0\n                });\n                throw _context19.t0;\n\n              case 11:\n              case 'end':\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this, [[0, 7]]);\n      }));\n\n      function vendorRequest(_x3, _x4, _x5) {\n        return _ref23.apply(this, arguments);\n      }\n\n      return vendorRequest;\n    }()\n  }, {\n    key: 'vendorWrite',\n    value: function () {\n      var _ref24 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee20(event, controlParams, message) {\n        var result;\n        return _regenerator2.default.wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                if (!message || !message.length) {\n                  message = Buffer.from([]);\n                }\n\n                _context20.prev = 1;\n                _context20.next = 4;\n                return this.device.vendorWrite(controlParams, message);\n\n              case 4:\n                result = _context20.sent;\n                return _context20.abrupt('return', result.data);\n\n              case 8:\n                _context20.prev = 8;\n                _context20.t0 = _context20['catch'](1);\n                ErrorEvent.broadcast(this, {\n                  event: 'Panda.' + event + ' failed',\n                  error: _context20.t0\n                });\n                throw _context20.t0;\n\n              case 12:\n              case 'end':\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this, [[1, 8]]);\n      }));\n\n      function vendorWrite(_x6, _x7, _x8) {\n        return _ref24.apply(this, arguments);\n      }\n\n      return vendorWrite;\n    }() // event handlers\n\n  }, {\n    key: 'connectHandler',\n    value: function connectHandler(usbId) {\n      this.connected = usbId;\n      ConnectEvent.broadcast(this, usbId);\n    }\n  }, {\n    key: 'disconnectHandler',\n    value: function disconnectHandler() {\n      var previousConnection = this.connected;\n      this.connected = false;\n      this.paused = true;\n      DisconnectEvent.broadcast(this, previousConnection);\n    } // message queueing and flushing\n\n  }, {\n    key: 'needsFlushMessageQueue',\n    value: function needsFlushMessageQueue() {\n      var _this = this;\n\n      this.needsFlush = true;\n\n      if (this.flushEvent) {\n        return this.flushEvent;\n      }\n\n      var unlisten = (0, _raf2.default)(this.flushMessageQueue);\n\n      this.flushEvent = function () {\n        _raf2.default.cancel(unlisten);\n\n        _this.flushEvent = false;\n      };\n\n      return this.flushEvent;\n    }\n  }, {\n    key: 'flushMessageQueue',\n    value: function flushMessageQueue() {\n      this.flushEvent();\n\n      if (this.needsFlush && this.messageQueue.length) {\n        var messageQueue = this.messageQueue;\n        this.messageQueue = [];\n        this.needsFlush = false;\n        MessageEvent.broadcast(this, messageQueue);\n      }\n    } // internal reading loop\n\n  }, {\n    key: 'startReading',\n    value: function startReading() {\n      if (this.isReading) {\n        return true;\n      }\n\n      if (this.isPaused()) {\n        return false;\n      } // start loop!\n\n\n      this.isReading = true;\n      this.readLoop();\n    }\n  }, {\n    key: 'readLoop',\n    value: function () {\n      var _ref25 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee21() {\n        var i, data, receiptTime, canMessages;\n        return _regenerator2.default.wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                if (!this.isPaused()) {\n                  _context21.next = 3;\n                  break;\n                }\n\n                this.isReading = false;\n                return _context21.abrupt('return', false);\n\n              case 3:\n                this.isReading = true;\n                i = 0;\n\n              case 5:\n                if (!(i < MAX_MESSAGE_QUEUE)) {\n                  _context21.next = 20;\n                  break;\n                }\n\n                _context21.next = 8;\n                return this.device.nextMessage();\n\n              case 8:\n                data = _context21.sent;\n                receiptTime = (0, _performanceNow2.default)() / 1000;\n                canMessages = (0, _canMessage.unpackCAN)(data);\n\n                if (canMessages.length) {\n                  _context21.next = 15;\n                  break;\n                }\n\n                _context21.next = 14;\n                return (0, _delay2.default)(1);\n\n              case 14:\n                return _context21.abrupt('continue', 17);\n\n              case 15:\n                this.messageQueue.push({\n                  time: receiptTime,\n                  canMessages: canMessages\n                });\n                this.needsFlushMessageQueue();\n\n              case 17:\n                ++i;\n                _context21.next = 5;\n                break;\n\n              case 20:\n                this.needsFlushMessageQueue(); // repeat!\n\n                (0, _thyming.timeout)(this.readLoop);\n\n              case 22:\n              case 'end':\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n\n      function readLoop() {\n        return _ref25.apply(this, arguments);\n      }\n\n      return readLoop;\n    }()\n  }]);\n  return Panda;\n}();\n\nexports.default = Panda;","map":{"version":3,"sources":["/home/amax/Autoro/cabana/node_modules/@commaai/pandajs/lib/panda.js"],"names":["Object","defineProperty","exports","value","_slicedToArray2","require","_slicedToArray3","_interopRequireDefault","_regenerator","_regenerator2","_asyncToGenerator2","_asyncToGenerator3","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_canMessage","_weakmapEvent","_weakmapEvent2","_ap","_performanceNow","_performanceNow2","_raf","_raf2","_thyming","_delay","_delay2","obj","__esModule","default","MAX_MESSAGE_QUEUE","MessageEvent","ErrorEvent","ConnectEvent","DisconnectEvent","Panda","options","onMessage","partial","listen","onError","onConnect","onDisconnect","device","broadcast","connectHandler","bind","disconnectHandler","paused","messageQueue","readLoop","flushMessageQueue","key","isConnected","connected","isPaused","_ref","mark","_callee","serialNumber","wrap","_callee$","_context","prev","next","abrupt","connect","getSerialNumber","sent","stop","apply","arguments","_ref2","_callee2","_callee2$","_context2","disconnect","_ref3","_callee3","_callee3$","_context3","unpause","start","_ref4","_callee4","wasPaused","_callee4$","_context4","pause","_ref5","_callee5","_callee5$","_context5","resume","_ref6","_callee6","_callee6$","_context6","startReading","_ref7","_callee7","buf","voltage","current","isStarted","controlsAreAllowed","isGasInterceptorDetector","isStartSignalDetected","isStartedAlt","_callee7$","_context7","vendorRequest","request","index","readUInt32LE","readInt8","getHealth","_ref8","_callee8","serial","secret","hashSig","_callee8$","_context8","slice","toString","getDeviceMetadata","_ref9","_callee9","_ref10","_ref11","_callee9$","_context9","_ref12","_callee10","_ref13","_ref14","_callee10$","_context10","getSecret","_ref15","_callee11","_callee11$","_context11","getVersion","_ref16","_callee12","_callee12$","_context12","length","getType","_ref17","_callee13","_callee13$","_context13","t0","isWhite","_ref18","_callee14","_callee14$","_context14","isGrey","_ref19","_callee15","_callee15$","_context15","isBlack","_ref20","_callee16","_callee16$","_context16","hasObd","_ref21","_callee17","obd","_callee17$","_context17","vendorWrite","setObd","_x","_ref22","_callee18","mode","_callee18$","_context18","setSafetyMode","_x2","_ref23","_callee19","event","controlParams","result","_callee19$","_context19","data","error","_x3","_x4","_x5","_ref24","_callee20","message","_callee20$","_context20","Buffer","from","_x6","_x7","_x8","usbId","previousConnection","needsFlushMessageQueue","_this","needsFlush","flushEvent","unlisten","cancel","isReading","_ref25","_callee21","i","receiptTime","canMessages","_callee21$","_context21","nextMessage","unpackCAN","push","time","timeout"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _canMessage = require('can-message');\n\nvar _weakmapEvent = require('weakmap-event');\n\nvar _weakmapEvent2 = _interopRequireDefault(_weakmapEvent);\n\nvar _ap = require('ap');\n\nvar _performanceNow = require('performance-now');\n\nvar _performanceNow2 = _interopRequireDefault(_performanceNow);\n\nvar _raf = require('raf');\n\nvar _raf2 = _interopRequireDefault(_raf);\n\nvar _thyming = require('thyming');\n\nvar _delay = require('./delay');\n\nvar _delay2 = _interopRequireDefault(_delay);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// how many messages to batch at maximum when reading as fast as we can\nvar MAX_MESSAGE_QUEUE = 5000;\n\nvar MessageEvent = (0, _weakmapEvent2.default)();\nvar ErrorEvent = (0, _weakmapEvent2.default)();\nvar ConnectEvent = (0, _weakmapEvent2.default)();\nvar DisconnectEvent = (0, _weakmapEvent2.default)();\n\nvar Panda = function () {\n  function Panda(options) {\n    (0, _classCallCheck3.default)(this, Panda);\n\n    // setup event handlers\n    this.onMessage = (0, _ap.partial)(MessageEvent.listen, this);\n    this.onError = (0, _ap.partial)(ErrorEvent.listen, this);\n    this.onConnect = (0, _ap.partial)(ConnectEvent.listen, this);\n    this.onDisconnect = (0, _ap.partial)(DisconnectEvent.listen, this);\n\n    // initialize device object\n    this.device = options.device;\n    this.device.onError((0, _ap.partial)(ErrorEvent.broadcast, this));\n    this.device.onConnect(this.connectHandler.bind(this));\n    this.device.onDisconnect(this.disconnectHandler.bind(this));\n\n    // member variables\n    this.paused = true;\n    this.messageQueue = [];\n\n    // function binding\n    this.readLoop = this.readLoop.bind(this);\n    this.flushMessageQueue = this.flushMessageQueue.bind(this);\n  }\n\n  // state getters\n\n\n  (0, _createClass3.default)(Panda, [{\n    key: 'isConnected',\n    value: function isConnected() {\n      return !!this.connected;\n    }\n  }, {\n    key: 'isPaused',\n    value: function isPaused() {\n      return !!this.paused;\n    }\n\n    // methods\n\n  }, {\n    key: 'connect',\n    value: function () {\n      var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n        var serialNumber;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.isConnected()) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt('return', this.connected);\n\n              case 2:\n                _context.next = 4;\n                return this.device.connect();\n\n              case 4:\n                _context.next = 6;\n                return this.getSerialNumber();\n\n              case 6:\n                serialNumber = _context.sent;\n\n                this.connectHandler(serialNumber);\n\n                return _context.abrupt('return', serialNumber);\n\n              case 9:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function connect() {\n        return _ref.apply(this, arguments);\n      }\n\n      return connect;\n    }()\n  }, {\n    key: 'disconnect',\n    value: function () {\n      var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.isConnected()) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt('return', false);\n\n              case 2:\n                return _context2.abrupt('return', this.device.disconnect());\n\n              case 3:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function disconnect() {\n        return _ref2.apply(this, arguments);\n      }\n\n      return disconnect;\n    }()\n  }, {\n    key: 'start',\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3() {\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.connect();\n\n              case 2:\n                return _context3.abrupt('return', this.unpause());\n\n              case 3:\n              case 'end':\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function start() {\n        return _ref3.apply(this, arguments);\n      }\n\n      return start;\n    }()\n  }, {\n    key: 'pause',\n    value: function () {\n      var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4() {\n        var wasPaused;\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                wasPaused = this.isPaused();\n\n                this.paused = true;\n\n                return _context4.abrupt('return', !wasPaused);\n\n              case 3:\n              case 'end':\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function pause() {\n        return _ref4.apply(this, arguments);\n      }\n\n      return pause;\n    }()\n  }, {\n    key: 'resume',\n    value: function () {\n      var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5() {\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                return _context5.abrupt('return', this.unpause());\n\n              case 1:\n              case 'end':\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function resume() {\n        return _ref5.apply(this, arguments);\n      }\n\n      return resume;\n    }()\n  }, {\n    key: 'unpause',\n    value: function () {\n      var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6() {\n        var wasPaused;\n        return _regenerator2.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                wasPaused = this.isPaused();\n\n                if (wasPaused) {\n                  _context6.next = 3;\n                  break;\n                }\n\n                return _context6.abrupt('return', false);\n\n              case 3:\n\n                this.paused = false;\n                this.startReading();\n\n                return _context6.abrupt('return', wasPaused);\n\n              case 6:\n              case 'end':\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function unpause() {\n        return _ref6.apply(this, arguments);\n      }\n\n      return unpause;\n    }()\n\n    // vendor API methods\n\n  }, {\n    key: 'getHealth',\n    value: function () {\n      var _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7() {\n        var buf, voltage, current, isStarted, controlsAreAllowed, isGasInterceptorDetector, isStartSignalDetected, isStartedAlt;\n        return _regenerator2.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this.vendorRequest('health', {\n                  request: 0xd2,\n                  value: 0,\n                  index: 0\n                }, 13);\n\n              case 2:\n                buf = _context7.sent;\n                voltage = buf.readUInt32LE(0) / 1000;\n                current = buf.readUInt32LE(4) / 1000;\n                isStarted = buf.readInt8(8) === 1;\n                controlsAreAllowed = buf.readInt8(9) === 1;\n                isGasInterceptorDetector = buf.readInt8(10) === 1;\n                isStartSignalDetected = buf.readInt8(11) === 1;\n                isStartedAlt = buf.readInt8(12) === 1;\n                return _context7.abrupt('return', {\n                  voltage: voltage,\n                  current: current,\n                  isStarted: isStarted,\n                  controlsAreAllowed: controlsAreAllowed,\n                  isGasInterceptorDetector: isGasInterceptorDetector,\n                  isStartSignalDetected: isStartSignalDetected,\n                  isStartedAlt: isStartedAlt\n                });\n\n              case 11:\n              case 'end':\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function getHealth() {\n        return _ref7.apply(this, arguments);\n      }\n\n      return getHealth;\n    }()\n  }, {\n    key: 'getDeviceMetadata',\n    value: function () {\n      var _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee8() {\n        var buf, serial, secret, hashSig;\n        return _regenerator2.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.next = 2;\n                return this.vendorRequest('getDeviceMetadata', {\n                  request: 0xd0,\n                  value: 0,\n                  index: 0\n                }, 0x20);\n\n              case 2:\n                buf = _context8.sent;\n                serial = buf.slice(0, 0x10); // serial is the wifi style serial\n\n                secret = buf.slice(0x10, 0x10 + 10);\n                hashSig = buf.slice(0x1c);\n                return _context8.abrupt('return', [serial.toString(), secret.toString()]);\n\n              case 7:\n              case 'end':\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function getDeviceMetadata() {\n        return _ref8.apply(this, arguments);\n      }\n\n      return getDeviceMetadata;\n    }()\n  }, {\n    key: 'getSerialNumber',\n    value: function () {\n      var _ref9 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee9() {\n        var _ref10, _ref11, serial, secret;\n\n        return _regenerator2.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return this.getDeviceMetadata();\n\n              case 2:\n                _ref10 = _context9.sent;\n                _ref11 = (0, _slicedToArray3.default)(_ref10, 2);\n                serial = _ref11[0];\n                secret = _ref11[1];\n                return _context9.abrupt('return', serial);\n\n              case 7:\n              case 'end':\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function getSerialNumber() {\n        return _ref9.apply(this, arguments);\n      }\n\n      return getSerialNumber;\n    }()\n  }, {\n    key: 'getSecret',\n    value: function () {\n      var _ref12 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee10() {\n        var _ref13, _ref14, serial, secret;\n\n        return _regenerator2.default.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _context10.next = 2;\n                return this.getDeviceMetadata();\n\n              case 2:\n                _ref13 = _context10.sent;\n                _ref14 = (0, _slicedToArray3.default)(_ref13, 2);\n                serial = _ref14[0];\n                secret = _ref14[1];\n                return _context10.abrupt('return', secret);\n\n              case 7:\n              case 'end':\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function getSecret() {\n        return _ref12.apply(this, arguments);\n      }\n\n      return getSecret;\n    }()\n  }, {\n    key: 'getVersion',\n    value: function () {\n      var _ref15 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee11() {\n        var buf;\n        return _regenerator2.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                _context11.next = 2;\n                return this.vendorRequest('getVersion', {\n                  request: 0xd6,\n                  value: 0,\n                  index: 0\n                }, 0x40);\n\n              case 2:\n                buf = _context11.sent;\n                return _context11.abrupt('return', buf.toString());\n\n              case 4:\n              case 'end':\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function getVersion() {\n        return _ref15.apply(this, arguments);\n      }\n\n      return getVersion;\n    }()\n  }, {\n    key: 'getType',\n    value: function () {\n      var _ref16 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee12() {\n        var buf;\n        return _regenerator2.default.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                _context12.next = 2;\n                return this.vendorRequest('getType', {\n                  request: 0xc1,\n                  value: 0,\n                  index: 0\n                }, 0x40);\n\n              case 2:\n                buf = _context12.sent;\n                return _context12.abrupt('return', buf.length ? buf[0] : null);\n\n              case 4:\n              case 'end':\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function getType() {\n        return _ref16.apply(this, arguments);\n      }\n\n      return getType;\n    }()\n  }, {\n    key: 'isWhite',\n    value: function () {\n      var _ref17 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee13() {\n        return _regenerator2.default.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _context13.next = 2;\n                return this.getType();\n\n              case 2:\n                _context13.t0 = _context13.sent;\n                return _context13.abrupt('return', _context13.t0 === 1);\n\n              case 4:\n              case 'end':\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function isWhite() {\n        return _ref17.apply(this, arguments);\n      }\n\n      return isWhite;\n    }()\n  }, {\n    key: 'isGrey',\n    value: function () {\n      var _ref18 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee14() {\n        return _regenerator2.default.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                _context14.next = 2;\n                return this.getType();\n\n              case 2:\n                _context14.t0 = _context14.sent;\n                return _context14.abrupt('return', _context14.t0 === 2);\n\n              case 4:\n              case 'end':\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function isGrey() {\n        return _ref18.apply(this, arguments);\n      }\n\n      return isGrey;\n    }()\n  }, {\n    key: 'isBlack',\n    value: function () {\n      var _ref19 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee15() {\n        return _regenerator2.default.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                _context15.next = 2;\n                return this.getType();\n\n              case 2:\n                _context15.t0 = _context15.sent;\n                return _context15.abrupt('return', _context15.t0 === 3);\n\n              case 4:\n              case 'end':\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n\n      function isBlack() {\n        return _ref19.apply(this, arguments);\n      }\n\n      return isBlack;\n    }()\n  }, {\n    key: 'hasObd',\n    value: function () {\n      var _ref20 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee16() {\n        return _regenerator2.default.wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.next = 2;\n                return this.getType();\n\n              case 2:\n                _context16.t0 = _context16.sent;\n                return _context16.abrupt('return', _context16.t0 > 2);\n\n              case 4:\n              case 'end':\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n\n      function hasObd() {\n        return _ref20.apply(this, arguments);\n      }\n\n      return hasObd;\n    }()\n  }, {\n    key: 'setObd',\n    value: function () {\n      var _ref21 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee17(obd) {\n        return _regenerator2.default.wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                _context17.next = 2;\n                return this.vendorWrite('setObd', {\n                  request: 0xdb,\n                  value: obd ? 1 : 0,\n                  index: 0\n                });\n\n              case 2:\n              case 'end':\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n\n      function setObd(_x) {\n        return _ref21.apply(this, arguments);\n      }\n\n      return setObd;\n    }()\n  }, {\n    key: 'setSafetyMode',\n    value: function () {\n      var _ref22 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee18(mode) {\n        return _regenerator2.default.wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                _context18.next = 2;\n                return this.vendorWrite('setSafetyMode', {\n                  request: 0xdc,\n                  value: mode,\n                  index: 0\n                });\n\n              case 2:\n              case 'end':\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n\n      function setSafetyMode(_x2) {\n        return _ref22.apply(this, arguments);\n      }\n\n      return setSafetyMode;\n    }()\n\n    // i/o wrappers\n\n  }, {\n    key: 'vendorRequest',\n    value: function () {\n      var _ref23 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee19(event, controlParams, length) {\n        var result;\n        return _regenerator2.default.wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.prev = 0;\n                _context19.next = 3;\n                return this.device.vendorRequest(controlParams, length);\n\n              case 3:\n                result = _context19.sent;\n                return _context19.abrupt('return', result.data);\n\n              case 7:\n                _context19.prev = 7;\n                _context19.t0 = _context19['catch'](0);\n\n                ErrorEvent.broadcast(this, { event: 'Panda.' + event + ' failed', error: _context19.t0 });\n                throw _context19.t0;\n\n              case 11:\n              case 'end':\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this, [[0, 7]]);\n      }));\n\n      function vendorRequest(_x3, _x4, _x5) {\n        return _ref23.apply(this, arguments);\n      }\n\n      return vendorRequest;\n    }()\n  }, {\n    key: 'vendorWrite',\n    value: function () {\n      var _ref24 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee20(event, controlParams, message) {\n        var result;\n        return _regenerator2.default.wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                if (!message || !message.length) {\n                  message = Buffer.from([]);\n                }\n                _context20.prev = 1;\n                _context20.next = 4;\n                return this.device.vendorWrite(controlParams, message);\n\n              case 4:\n                result = _context20.sent;\n                return _context20.abrupt('return', result.data);\n\n              case 8:\n                _context20.prev = 8;\n                _context20.t0 = _context20['catch'](1);\n\n                ErrorEvent.broadcast(this, { event: 'Panda.' + event + ' failed', error: _context20.t0 });\n                throw _context20.t0;\n\n              case 12:\n              case 'end':\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this, [[1, 8]]);\n      }));\n\n      function vendorWrite(_x6, _x7, _x8) {\n        return _ref24.apply(this, arguments);\n      }\n\n      return vendorWrite;\n    }()\n\n    // event handlers\n\n  }, {\n    key: 'connectHandler',\n    value: function connectHandler(usbId) {\n      this.connected = usbId;\n      ConnectEvent.broadcast(this, usbId);\n    }\n  }, {\n    key: 'disconnectHandler',\n    value: function disconnectHandler() {\n      var previousConnection = this.connected;\n      this.connected = false;\n      this.paused = true;\n      DisconnectEvent.broadcast(this, previousConnection);\n    }\n\n    // message queueing and flushing\n\n  }, {\n    key: 'needsFlushMessageQueue',\n    value: function needsFlushMessageQueue() {\n      var _this = this;\n\n      this.needsFlush = true;\n      if (this.flushEvent) {\n        return this.flushEvent;\n      }\n\n      var unlisten = (0, _raf2.default)(this.flushMessageQueue);\n\n      this.flushEvent = function () {\n        _raf2.default.cancel(unlisten);\n        _this.flushEvent = false;\n      };\n\n      return this.flushEvent;\n    }\n  }, {\n    key: 'flushMessageQueue',\n    value: function flushMessageQueue() {\n      this.flushEvent();\n\n      if (this.needsFlush && this.messageQueue.length) {\n        var messageQueue = this.messageQueue;\n        this.messageQueue = [];\n        this.needsFlush = false;\n        MessageEvent.broadcast(this, messageQueue);\n      }\n    }\n    // internal reading loop\n\n  }, {\n    key: 'startReading',\n    value: function startReading() {\n      if (this.isReading) {\n        return true;\n      }\n      if (this.isPaused()) {\n        return false;\n      }\n\n      // start loop!\n      this.isReading = true;\n      this.readLoop();\n    }\n  }, {\n    key: 'readLoop',\n    value: function () {\n      var _ref25 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee21() {\n        var i, data, receiptTime, canMessages;\n        return _regenerator2.default.wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                if (!this.isPaused()) {\n                  _context21.next = 3;\n                  break;\n                }\n\n                this.isReading = false;\n                return _context21.abrupt('return', false);\n\n              case 3:\n                this.isReading = true;\n\n                i = 0;\n\n              case 5:\n                if (!(i < MAX_MESSAGE_QUEUE)) {\n                  _context21.next = 20;\n                  break;\n                }\n\n                _context21.next = 8;\n                return this.device.nextMessage();\n\n              case 8:\n                data = _context21.sent;\n                receiptTime = (0, _performanceNow2.default)() / 1000;\n                canMessages = (0, _canMessage.unpackCAN)(data);\n\n                if (canMessages.length) {\n                  _context21.next = 15;\n                  break;\n                }\n\n                _context21.next = 14;\n                return (0, _delay2.default)(1);\n\n              case 14:\n                return _context21.abrupt('continue', 17);\n\n              case 15:\n                this.messageQueue.push({\n                  time: receiptTime,\n                  canMessages: canMessages\n                });\n                this.needsFlushMessageQueue();\n\n              case 17:\n                ++i;\n                _context21.next = 5;\n                break;\n\n              case 20:\n                this.needsFlushMessageQueue();\n\n                // repeat!\n                (0, _thyming.timeout)(this.readLoop);\n\n              case 22:\n              case 'end':\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n\n      function readLoop() {\n        return _ref25.apply(this, arguments);\n      }\n\n      return readLoop;\n    }()\n  }]);\n  return Panda;\n}();\n\nexports.default = Panda;"]},"metadata":{},"sourceType":"script"}