{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getCommaAccessToken = exports.logOut = exports.isAuthed = undefined;\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar logOut = exports.logOut = function () {\n  var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            localStorage.removeItem('authorization');\n\n            if (!useForage) {\n              _context.next = 4;\n              break;\n            }\n\n            _context.next = 4;\n            return _localforage2.default.removeItem('authorization');\n\n          case 4:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function logOut() {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar getCommaAccessToken = exports.getCommaAccessToken = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n    var token;\n    return _regenerator2.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            token = getTokenInternal();\n\n            if (token) {\n              _context2.next = 11;\n              break;\n            }\n\n            _context2.prev = 2;\n            _context2.next = 5;\n            return _localforage2.default.getItem('authorization');\n\n          case 5:\n            token = _context2.sent;\n            _context2.next = 11;\n            break;\n\n          case 8:\n            _context2.prev = 8;\n            _context2.t0 = _context2['catch'](2);\n            useForage = false;\n\n          case 11:\n            if (!token) {\n              _context2.next = 16;\n              break;\n            }\n\n            exports.isAuthed = isAuthed = true;\n\n            if (!useForage) {\n              _context2.next = 16;\n              break;\n            }\n\n            _context2.next = 16;\n            return _localforage2.default.setItem('authorization', token);\n\n          case 16:\n            return _context2.abrupt('return', token);\n\n          case 17:\n          case 'end':\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this, [[2, 8]]);\n  }));\n\n  return function getCommaAccessToken() {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.getTokenInternal = getTokenInternal;\nexports.setCommaAccessToken = setCommaAccessToken;\n\nvar _localforage = require('localforage');\n\nvar _localforage2 = _interopRequireDefault(_localforage);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar isAuthed = exports.isAuthed = false;\nvar useForage = true;\n\nfunction getTokenInternal() {\n  if (typeof localStorage !== 'undefined') {\n    if (localStorage.authorization) {\n      return localStorage.authorization;\n    }\n  }\n\n  return null;\n}\n\nfunction setCommaAccessToken(token) {\n  localStorage.setItem('authorization', token);\n  return getCommaAccessToken();\n}","map":{"version":3,"sources":["/home/amax/Autoro/cabana/node_modules/@commaai/my-comma-auth/dist/storage.js"],"names":["Object","defineProperty","exports","value","getCommaAccessToken","logOut","isAuthed","undefined","_regenerator","require","_regenerator2","_interopRequireDefault","_asyncToGenerator2","_asyncToGenerator3","_ref","default","mark","_callee","wrap","_callee$","_context","prev","next","localStorage","removeItem","useForage","_localforage2","stop","apply","arguments","_ref2","_callee2","token","_callee2$","_context2","getTokenInternal","getItem","sent","t0","setItem","abrupt","setCommaAccessToken","_localforage","obj","__esModule","authorization"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getCommaAccessToken = exports.logOut = exports.isAuthed = undefined;\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar logOut = exports.logOut = function () {\n  var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            localStorage.removeItem('authorization');\n\n            if (!useForage) {\n              _context.next = 4;\n              break;\n            }\n\n            _context.next = 4;\n            return _localforage2.default.removeItem('authorization');\n\n          case 4:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function logOut() {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar getCommaAccessToken = exports.getCommaAccessToken = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n    var token;\n    return _regenerator2.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            token = getTokenInternal();\n\n            if (token) {\n              _context2.next = 11;\n              break;\n            }\n\n            _context2.prev = 2;\n            _context2.next = 5;\n            return _localforage2.default.getItem('authorization');\n\n          case 5:\n            token = _context2.sent;\n            _context2.next = 11;\n            break;\n\n          case 8:\n            _context2.prev = 8;\n            _context2.t0 = _context2['catch'](2);\n\n            useForage = false;\n\n          case 11:\n            if (!token) {\n              _context2.next = 16;\n              break;\n            }\n\n            exports.isAuthed = isAuthed = true;\n\n            if (!useForage) {\n              _context2.next = 16;\n              break;\n            }\n\n            _context2.next = 16;\n            return _localforage2.default.setItem('authorization', token);\n\n          case 16:\n            return _context2.abrupt('return', token);\n\n          case 17:\n          case 'end':\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this, [[2, 8]]);\n  }));\n\n  return function getCommaAccessToken() {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.getTokenInternal = getTokenInternal;\nexports.setCommaAccessToken = setCommaAccessToken;\n\nvar _localforage = require('localforage');\n\nvar _localforage2 = _interopRequireDefault(_localforage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar isAuthed = exports.isAuthed = false;\nvar useForage = true;\n\nfunction getTokenInternal() {\n  if (typeof localStorage !== 'undefined') {\n    if (localStorage.authorization) {\n      return localStorage.authorization;\n    }\n  }\n  return null;\n}\n\nfunction setCommaAccessToken(token) {\n  localStorage.setItem('authorization', token);\n  return getCommaAccessToken();\n}"]},"metadata":{},"sourceType":"script"}