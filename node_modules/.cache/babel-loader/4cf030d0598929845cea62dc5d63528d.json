{"ast":null,"code":"var _jsxFileName = \"/home/amax/Autoro/cabana/src/components/Modals/OnboardingModal.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport qs from 'query-string';\nimport CommaAuth, { config as AuthConfig } from '@commaai/my-comma-auth';\nimport { EXPLORER_URL } from '../../config';\nimport Modal from './baseModal';\nexport default class OnboardingModal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      webUsbEnabled: !!navigator.usb,\n      viewingUsbInstructions: false,\n      pandaConnected: false\n    };\n    this.attemptPandaConnection = this.attemptPandaConnection.bind(this);\n    this.toggleUsbInstructions = this.toggleUsbInstructions.bind(this);\n    this.navigateToExplorer = this.navigateToExplorer.bind(this);\n  }\n\n  componentDidMount() {\n    const script = document.createElement(\"script\");\n    document.body.appendChild(script);\n\n    script.onload = () => {\n      window.AppleID.auth.init({\n        clientId: AuthConfig.APPLE_CLIENT_ID,\n        scope: AuthConfig.APPLE_SCOPES,\n        redirectURI: AuthConfig.APPLE_REDIRECT_URI,\n        state: AuthConfig.APPLE_STATE\n      });\n    };\n\n    script.src = \"https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js\";\n    script.async = true;\n    document.addEventListener('AppleIDSignInOnSuccess', data => {\n      const {\n        code,\n        state\n      } = data.detail.authorization;\n      window.location = [AuthConfig.APPLE_REDIRECT_PATH, qs.stringify({\n        code,\n        state\n      })].join('?');\n    });\n    document.addEventListener('AppleIDSignInOnFailure', console.log);\n  }\n\n  attemptPandaConnection() {\n    if (!this.state.webUsbEnabled) {\n      return;\n    }\n\n    this.props.handlePandaConnect();\n  }\n\n  toggleUsbInstructions() {\n    this.setState({\n      viewingUsbInstructions: !this.state.viewingUsbInstructions\n    });\n  }\n\n  navigateToExplorer() {\n    window.location.href = EXPLORER_URL;\n  }\n\n  filterRoutesWithCan(drive) {\n    return drive.can === true;\n  }\n\n  renderPandaEligibility() {\n    const {\n      webUsbEnabled,\n      pandaConnected\n    } = this.state;\n    const {\n      attemptingPandaConnection\n    } = this.props;\n\n    if (!webUsbEnabled) {\n      return /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fa fa-exclamation-triangle\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"span\", {\n        onClick: this.toggleUsbInstructions,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 13\n        }\n      }, \"WebUSB is not enabled in your Chrome settings\")));\n    }\n\n    if (!pandaConnected && attemptingPandaConnection) {\n      return /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fa fa-spinner animate-spin\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"span\", {\n        className: \"animate-pulse-opacity\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }\n      }, \"Waiting for panda USB connection\"));\n    }\n  }\n\n  renderLogin() {\n    if (CommaAuth.isAuthenticated()) {\n      return /*#__PURE__*/React.createElement(\"button\", {\n        onClick: this.navigateToExplorer,\n        className: \"button--primary button--kiosk\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fa fa-video-camera\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 11\n        }\n      }, \"Find a drive in connect\"), /*#__PURE__*/React.createElement(\"sup\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 11\n        }\n      }, \"Click \\\"View in cabana\\\" while replaying a drive\"));\n    } else {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"a\", {\n        href: AuthConfig.GOOGLE_REDIRECT_LINK,\n        className: \"button button--primary button--icon\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fa fa-google\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 11\n        }\n      }, \"Sign in with Google\")), /*#__PURE__*/React.createElement(\"button\", {\n        onClick: () => window.AppleID.auth.signIn(),\n        className: \"button button--primary button--icon\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fa fa-apple\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 11\n        }\n      }, \"Sign in with Apple\")), /*#__PURE__*/React.createElement(\"a\", {\n        href: AuthConfig.GITHUB_REDIRECT_LINK,\n        className: \"button button--primary button--icon\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fa fa-github\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 11\n        }\n      }, \"Sign in with GitHub\")));\n    }\n  }\n\n  renderOnboardingOptions() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cabana-onboarding-modes\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cabana-onboarding-mode\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }\n    }, this.renderLogin()), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cabana-onboarding-mode\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: cx('button--secondary button--kiosk', {\n        'is-disabled': !this.state.webUsbEnabled || this.props.attemptingPandaConnection\n      }),\n      onClick: this.attemptPandaConnection,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fa fa-bolt\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 13\n      }\n    }, \"Launch Realtime Streaming\"), /*#__PURE__*/React.createElement(\"sup\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 13\n      }\n    }, \"Interactively stream car data over USB with\", ' ', /*#__PURE__*/React.createElement(\"em\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 15\n      }\n    }, \"panda\")), this.renderPandaEligibility())));\n  }\n\n  renderUsbInstructions() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cabana-onboarding-instructions\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"button--small button--inverted\",\n      onClick: this.toggleUsbInstructions,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fa fa-chevron-left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 11\n      }\n    }, \" Go back\")), /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }\n    }, \"Follow these directions to enable WebUSB:\"), /*#__PURE__*/React.createElement(\"ol\", {\n      className: \"cabana-onboarding-instructions-list list--bubbled\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 15\n      }\n    }, \"Open your Chrome settings:\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"inset\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 15\n      }\n    }, \"chrome://flags/#enable-experimental-web-platform-features\"))), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 15\n      }\n    }, \"Enable Experimental Platform features:\")), /*#__PURE__*/React.createElement(\"img\", {\n      alt: \"Screenshot of Google Chrome Experimental Platform features\",\n      src: OnboardingModal.instructionalImages.step2,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 15\n      }\n    }, \"Enable WebUSB:\")), /*#__PURE__*/React.createElement(\"img\", {\n      alt: \"Screenshot of Google Chrome enable WebUSB\",\n      src: OnboardingModal.instructionalImages.step3,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 15\n      }\n    }, \"Relaunch your Chrome browser and try enabling live mode again.\")))));\n  }\n\n  renderModalContent() {\n    if (this.state.viewingUsbInstructions) {\n      return this.renderUsbInstructions();\n    }\n\n    return this.renderOnboardingOptions();\n  }\n\n  renderModalFooter() {\n    return /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }\n    }, \"Don't have a\", ' ', /*#__PURE__*/React.createElement(\"a\", {\n      href: \"https://comma.ai/shop/products/panda\",\n      target: \"_blank\",\n      rel: \"noopener noreferrer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 11\n      }\n    }, \"panda\"), \"?\", ' '), /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      href: \"https://comma.ai/shop/products/panda\",\n      target: \"_blank\",\n      rel: \"noopener noreferrer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 11\n      }\n    }, \"Get one here\"), ' '), /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 9\n      }\n    }, \"or\", ' ', /*#__PURE__*/React.createElement(\"a\", {\n      href: `${window.location.href}?demo=1`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 11\n      }\n    }, \"try the demo\"), \".\"));\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Modal, {\n      title: \"Welcome to Cabana\",\n      subtitle: \"Get started by selecting a drive from connect or enabling live mode\",\n      footer: this.renderModalFooter(),\n      disableClose: true,\n      variations: ['wide', 'dark'],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 7\n      }\n    }, this.renderModalContent());\n  }\n\n}\nOnboardingModal.propTypes = {\n  handlePandaConnect: PropTypes.func,\n  routes: PropTypes.array\n};\nOnboardingModal.instructionalImages = {\n  step2: require('../../images/webusb-enable-experimental-features.png'),\n  step3: require('../../images/webusb-enable-webusb.png')\n};","map":{"version":3,"sources":["/home/amax/Autoro/cabana/src/components/Modals/OnboardingModal.js"],"names":["React","Component","PropTypes","cx","qs","CommaAuth","config","AuthConfig","EXPLORER_URL","Modal","OnboardingModal","constructor","props","state","webUsbEnabled","navigator","usb","viewingUsbInstructions","pandaConnected","attemptPandaConnection","bind","toggleUsbInstructions","navigateToExplorer","componentDidMount","script","document","createElement","body","appendChild","onload","window","AppleID","auth","init","clientId","APPLE_CLIENT_ID","scope","APPLE_SCOPES","redirectURI","APPLE_REDIRECT_URI","APPLE_STATE","src","async","addEventListener","data","code","detail","authorization","location","APPLE_REDIRECT_PATH","stringify","join","console","log","handlePandaConnect","setState","href","filterRoutesWithCan","drive","can","renderPandaEligibility","attemptingPandaConnection","renderLogin","isAuthenticated","GOOGLE_REDIRECT_LINK","signIn","GITHUB_REDIRECT_LINK","renderOnboardingOptions","renderUsbInstructions","instructionalImages","step2","step3","renderModalContent","renderModalFooter","render","propTypes","func","routes","array","require"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport qs from 'query-string';\nimport CommaAuth, { config as AuthConfig } from '@commaai/my-comma-auth';\n\nimport { EXPLORER_URL } from '../../config';\nimport Modal from './baseModal';\n\nexport default class OnboardingModal extends Component {\n  static propTypes = {\n    handlePandaConnect: PropTypes.func,\n    routes: PropTypes.array\n  };\n\n  static instructionalImages = {\n    step2: require('../../images/webusb-enable-experimental-features.png'),\n    step3: require('../../images/webusb-enable-webusb.png')\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      webUsbEnabled: !!navigator.usb,\n      viewingUsbInstructions: false,\n      pandaConnected: false\n    };\n\n    this.attemptPandaConnection = this.attemptPandaConnection.bind(this);\n    this.toggleUsbInstructions = this.toggleUsbInstructions.bind(this);\n    this.navigateToExplorer = this.navigateToExplorer.bind(this);\n  }\n\n  componentDidMount() {\n    const script = document.createElement(\"script\");\n    document.body.appendChild(script);\n    script.onload = () => {\n      window.AppleID.auth.init({\n        clientId : AuthConfig.APPLE_CLIENT_ID,\n        scope : AuthConfig.APPLE_SCOPES,\n        redirectURI : AuthConfig.APPLE_REDIRECT_URI,\n        state : AuthConfig.APPLE_STATE,\n      });\n    };\n    script.src = \"https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js\";\n    script.async = true;\n    document.addEventListener('AppleIDSignInOnSuccess', (data) => {\n      const { code, state } = data.detail.authorization;\n      window.location = [AuthConfig.APPLE_REDIRECT_PATH, qs.stringify({ code, state })].join('?');\n    });\n    document.addEventListener('AppleIDSignInOnFailure', console.log);\n  }\n\n  attemptPandaConnection() {\n    if (!this.state.webUsbEnabled) {\n      return;\n    }\n    this.props.handlePandaConnect();\n  }\n\n  toggleUsbInstructions() {\n    this.setState({\n      viewingUsbInstructions: !this.state.viewingUsbInstructions\n    });\n  }\n\n  navigateToExplorer() {\n    window.location.href = EXPLORER_URL;\n  }\n\n  filterRoutesWithCan(drive) {\n    return drive.can === true;\n  }\n\n  renderPandaEligibility() {\n    const { webUsbEnabled, pandaConnected } = this.state;\n    const { attemptingPandaConnection } = this.props;\n    if (!webUsbEnabled) {\n      return (\n        <p>\n          <i className=\"fa fa-exclamation-triangle\" />\n          <span onClick={this.toggleUsbInstructions}>\n            <span>WebUSB is not enabled in your Chrome settings</span>\n          </span>\n        </p>\n      );\n    }\n    if (!pandaConnected && attemptingPandaConnection) {\n      return (\n        <p>\n          <i className=\"fa fa-spinner animate-spin\" />\n          <span className=\"animate-pulse-opacity\">\n            Waiting for panda USB connection\n          </span>\n        </p>\n      );\n    }\n  }\n\n  renderLogin() {\n    if (CommaAuth.isAuthenticated()) {\n      return (\n        <button onClick={this.navigateToExplorer} className=\"button--primary button--kiosk\">\n          <i className=\"fa fa-video-camera\" />\n          <strong>Find a drive in connect</strong>\n          <sup>Click \"View in cabana\" while replaying a drive</sup>\n        </button>\n      );\n    } else {\n      return <>\n        <a href={ AuthConfig.GOOGLE_REDIRECT_LINK } className=\"button button--primary button--icon\">\n          <i className=\"fa fa-google\" />\n          <strong>Sign in with Google</strong>\n        </a>\n        <button onClick={ () => window.AppleID.auth.signIn() } className=\"button button--primary button--icon\">\n          <i className=\"fa fa-apple\" />\n          <strong>Sign in with Apple</strong>\n        </button>\n        <a href={ AuthConfig.GITHUB_REDIRECT_LINK } className=\"button button--primary button--icon\">\n          <i className=\"fa fa-github\" />\n          <strong>Sign in with GitHub</strong>\n        </a>\n      </>;\n    }\n  }\n\n  renderOnboardingOptions() {\n    return (\n      <div className=\"cabana-onboarding-modes\">\n        <div className=\"cabana-onboarding-mode\">{this.renderLogin()}</div>\n        <div className=\"cabana-onboarding-mode\">\n          <button\n            className={cx('button--secondary button--kiosk', {\n              'is-disabled':\n                !this.state.webUsbEnabled\n                || this.props.attemptingPandaConnection\n            })}\n            onClick={this.attemptPandaConnection}\n          >\n            <i className=\"fa fa-bolt\" />\n            <strong>Launch Realtime Streaming</strong>\n            <sup>\n              Interactively stream car data over USB with\n              {' '}\n              <em>panda</em>\n            </sup>\n            {this.renderPandaEligibility()}\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  renderUsbInstructions() {\n    return (\n      <div className=\"cabana-onboarding-instructions\">\n        <button\n          className=\"button--small button--inverted\"\n          onClick={this.toggleUsbInstructions}\n        >\n          <i className=\"fa fa-chevron-left\" />\n          <span> Go back</span>\n        </button>\n        <h3>Follow these directions to enable WebUSB:</h3>\n        <ol className=\"cabana-onboarding-instructions-list list--bubbled\">\n          <li>\n            <p>\n              <strong>Open your Chrome settings:</strong>\n            </p>\n            <div className=\"inset\">\n              <span>\n                chrome://flags/#enable-experimental-web-platform-features\n              </span>\n            </div>\n          </li>\n          <li>\n            <p>\n              <strong>Enable Experimental Platform features:</strong>\n            </p>\n            <img\n              alt=\"Screenshot of Google Chrome Experimental Platform features\"\n              src={OnboardingModal.instructionalImages.step2}\n            />\n          </li>\n          <li>\n            <p>\n              <strong>Enable WebUSB:</strong>\n            </p>\n            <img\n              alt=\"Screenshot of Google Chrome enable WebUSB\"\n              src={OnboardingModal.instructionalImages.step3}\n            />\n          </li>\n          <li>\n            <p>\n              <strong>\n                Relaunch your Chrome browser and try enabling live mode again.\n              </strong>\n            </p>\n          </li>\n        </ol>\n      </div>\n    );\n  }\n\n  renderModalContent() {\n    if (this.state.viewingUsbInstructions) {\n      return this.renderUsbInstructions();\n    }\n    return this.renderOnboardingOptions();\n  }\n\n  renderModalFooter() {\n    return (\n      <p>\n        <span>\n          Don't have a\n          {' '}\n          <a\n            href=\"https://comma.ai/shop/products/panda\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            panda\n          </a>\n          ?\n          {' '}\n        </span>\n        <span>\n          <a\n            href=\"https://comma.ai/shop/products/panda\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Get one here\n          </a>\n          {' '}\n        </span>\n        <span>\n          or\n          {' '}\n          <a href={`${window.location.href}?demo=1`}>try the demo</a>\n.\n        </span>\n      </p>\n    );\n  }\n\n  render() {\n    return (\n      <Modal\n        title=\"Welcome to Cabana\"\n        subtitle=\"Get started by selecting a drive from connect or enabling live mode\"\n        footer={this.renderModalFooter()}\n        disableClose\n        variations={['wide', 'dark']}\n      >\n        {this.renderModalContent()}\n      </Modal>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}