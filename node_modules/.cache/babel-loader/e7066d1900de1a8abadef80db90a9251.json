{"ast":null,"code":"var _jsxFileName = \"/home/amax/Autoro/cabana/src/components/RouteSeeker/RouteSeeker.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport PlayButton from '../PlayButton';\nimport debounce from '../../utils/debounce';\nexport default class RouteSeeker extends Component {\n  constructor(props) {\n    super(props);\n    this.updateDraggingSeek = debounce(ratio => this.props.onUserSeek(ratio), 250);\n    this.state = {\n      seekedBarStyle: RouteSeeker.zeroSeekedBarStyle,\n      markerStyle: RouteSeeker.hiddenMarkerStyle,\n      tooltipStyle: RouteSeeker.hiddenTooltipStyle,\n      ratio: 0,\n      tooltipTime: '0:00',\n      isPlaying: false,\n      isDragging: false\n    };\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseLeave = this.onMouseLeave.bind(this);\n    this.onMouseDown = this.onMouseDown.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onClick = this.onClick.bind(this);\n    this.onPlay = this.onPlay.bind(this);\n    this.onPause = this.onPause.bind(this);\n    this.executePlayTimer = this.executePlayTimer.bind(this);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (JSON.stringify(prevProps.segmentIndices) !== JSON.stringify(this.props.segmentIndices)) {\n      this.setState({\n        seekedBarStyle: RouteSeeker.zeroSeekedBarStyle,\n        markerStyle: RouteSeeker.hiddenMarkerStyle,\n        ratio: 0\n      });\n    } else if (this.props.videoLength && prevProps.videoLength !== this.props.videoLength) {\n      // adjust ratio in line with new videoLength\n      const secondsSeeked = this.state.ratio * prevProps.videoLength;\n      const newRatio = secondsSeeked / this.props.videoLength;\n      this.updateSeekedBar(newRatio);\n    }\n\n    if (prevProps.nearestFrameTime !== this.props.nearestFrameTime) {\n      const newRatio = this.props.segmentProgress(this.props.nearestFrameTime);\n      this.updateSeekedBar(newRatio);\n    }\n\n    if (prevProps.playing !== this.props.isPlaying) {\n      if (this.props.playing && !this.state.isPlaying) {\n        this.onPlay();\n      } else if (!this.props.playing && this.state.isPlaying) {\n        this.onPause();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    window.cancelAnimationFrame(this.playTimer);\n  }\n\n  mouseEventXOffsetPercent(e) {\n    const rect = this.progressBar.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    return 100 * (x / this.progressBar.offsetWidth);\n  }\n\n  onMouseMove(e) {\n    const markerOffsetPct = this.mouseEventXOffsetPercent(e);\n\n    if (markerOffsetPct < 0) {\n      this.onMouseLeave();\n      return;\n    }\n\n    const {\n      markerWidth\n    } = RouteSeeker;\n    const markerLeft = `calc(${markerOffsetPct}% - ${markerWidth / 2}px)`;\n    const markerStyle = {\n      display: '',\n      left: markerLeft\n    };\n    const {\n      tooltipWidth\n    } = RouteSeeker;\n    const tooltipLeft = `calc(${markerOffsetPct}% - ${tooltipWidth / 2}px)`;\n    const tooltipStyle = {\n      display: 'flex',\n      left: tooltipLeft\n    };\n    const ratio = Math.max(0, markerOffsetPct / 100);\n\n    if (this.state.isDragging) {\n      this.updateSeekedBar(ratio);\n      this.updateDraggingSeek(ratio);\n    }\n\n    this.setState({\n      markerStyle,\n      tooltipStyle,\n      tooltipTime: this.props.ratioTime(ratio).toFixed(3)\n    });\n  }\n\n  onMouseLeave(e) {\n    this.setState({\n      markerStyle: RouteSeeker.hiddenMarkerStyle,\n      tooltipStyle: RouteSeeker.hiddenTooltipStyle,\n      isDragging: false\n    });\n  }\n\n  updateSeekedBar(ratio) {\n    const seekedBarStyle = {\n      width: `${100 * ratio}%`\n    };\n    this.setState({\n      seekedBarStyle,\n      ratio\n    });\n  }\n\n  onClick(e) {\n    let ratio = this.mouseEventXOffsetPercent(e) / 100;\n    ratio = Math.min(1, Math.max(0, ratio));\n    this.updateSeekedBar(ratio);\n    this.props.onUserSeek(ratio);\n  }\n\n  onPlay() {\n    this.playTimer = window.requestAnimationFrame(this.executePlayTimer);\n    let {\n      ratio\n    } = this.state;\n\n    if (ratio >= 1) {\n      ratio = 0;\n    }\n\n    this.setState({\n      isPlaying: true,\n      ratio\n    });\n    this.props.onPlay();\n  }\n\n  executePlayTimer() {\n    const {\n      videoElement\n    } = this.props;\n\n    if (videoElement === null) {\n      this.playTimer = window.requestAnimationFrame(this.executePlayTimer);\n      return;\n    }\n\n    let {\n      videoLength,\n      startTime\n    } = this.props;\n    let {\n      currentTime\n    } = videoElement;\n    currentTime = roundTime(currentTime);\n    startTime = roundTime(startTime);\n    videoLength = roundTime(videoLength);\n    let newRatio = (currentTime - startTime) / videoLength;\n\n    if (newRatio === this.state.ratio) {\n      this.playTimer = window.requestAnimationFrame(this.executePlayTimer);\n      return;\n    }\n\n    if (newRatio >= 1 && this.props.segment && this.props.segment.length || newRatio < 0) {\n      newRatio = 0;\n      currentTime = startTime;\n      this.props.onUserSeek(newRatio);\n    } else if (newRatio >= 1) {\n      videoElement.pause();\n      this.onPause();\n    }\n\n    if (newRatio >= 0) {\n      this.updateSeekedBar(newRatio);\n      this.props.onPlaySeek(currentTime);\n    }\n\n    this.playTimer = window.requestAnimationFrame(this.executePlayTimer);\n  }\n\n  onPause() {\n    window.cancelAnimationFrame(this.playTimer);\n    this.setState({\n      isPlaying: false\n    });\n    this.props.onPause();\n  }\n\n  onMouseDown() {\n    if (!this.state.isDragging) {\n      this.setState({\n        isDragging: true\n      });\n    }\n  }\n\n  onMouseUp() {\n    if (this.state.isDragging) {\n      this.setState({\n        isDragging: false\n      });\n    }\n  }\n\n  render() {\n    const {\n      seekedBarStyle,\n      markerStyle,\n      tooltipStyle\n    } = this.state;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cabana-explorer-visuals-camera-seeker\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(PlayButton, {\n      className: \"cabana-explorer-visuals-camera-seeker-playbutton\",\n      onPlay: this.onPlay,\n      onPause: this.onPause,\n      isPlaying: this.state.isPlaying,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cabana-explorer-visuals-camera-seeker-progress\",\n      onMouseMove: this.onMouseMove,\n      onMouseLeave: this.onMouseLeave,\n      onMouseDown: this.onMouseDown,\n      onMouseUp: this.onMouseUp,\n      onClick: this.onClick,\n      ref: ref => this.progressBar = ref,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cabana-explorer-visuals-camera-seeker-progress-tooltip\",\n      style: tooltipStyle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 11\n      }\n    }, this.state.tooltipTime), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cabana-explorer-visuals-camera-seeker-progress-marker\",\n      style: markerStyle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cabana-explorer-visuals-camera-seeker-progress-inner\",\n      style: seekedBarStyle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}\nRouteSeeker.propTypes = {\n  videoLength: PropTypes.number.isRequired,\n  segmentIndices: PropTypes.arrayOf(PropTypes.number),\n  segment: PropTypes.arrayOf(PropTypes.number),\n  onUserSeek: PropTypes.func,\n  onPlaySeek: PropTypes.func,\n  video: PropTypes.node,\n  onPause: PropTypes.func,\n  onPlay: PropTypes.func,\n  playing: PropTypes.bool,\n  segmentProgress: PropTypes.func,\n  ratioTime: PropTypes.func,\n  nearestFrameTime: PropTypes.number\n};\nRouteSeeker.hiddenMarkerStyle = {\n  display: 'none',\n  left: 0\n};\nRouteSeeker.zeroSeekedBarStyle = {\n  width: 0\n};\nRouteSeeker.hiddenTooltipStyle = {\n  display: 'none',\n  left: 0\n};\nRouteSeeker.markerWidth = 20;\nRouteSeeker.tooltipWidth = 50;\n\nfunction roundTime(time) {\n  return Math.round(time * 1000) / 1000;\n}","map":{"version":3,"sources":["/home/amax/Autoro/cabana/src/components/RouteSeeker/RouteSeeker.js"],"names":["React","Component","PropTypes","PlayButton","debounce","RouteSeeker","constructor","props","updateDraggingSeek","ratio","onUserSeek","state","seekedBarStyle","zeroSeekedBarStyle","markerStyle","hiddenMarkerStyle","tooltipStyle","hiddenTooltipStyle","tooltipTime","isPlaying","isDragging","onMouseMove","bind","onMouseLeave","onMouseDown","onMouseUp","onClick","onPlay","onPause","executePlayTimer","componentDidUpdate","prevProps","JSON","stringify","segmentIndices","setState","videoLength","secondsSeeked","newRatio","updateSeekedBar","nearestFrameTime","segmentProgress","playing","componentWillUnmount","window","cancelAnimationFrame","playTimer","mouseEventXOffsetPercent","e","rect","progressBar","getBoundingClientRect","x","clientX","left","offsetWidth","markerOffsetPct","markerWidth","markerLeft","display","tooltipWidth","tooltipLeft","Math","max","ratioTime","toFixed","width","min","requestAnimationFrame","videoElement","startTime","currentTime","roundTime","segment","length","pause","onPlaySeek","render","ref","propTypes","number","isRequired","arrayOf","func","video","node","bool","time","round"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport PlayButton from '../PlayButton';\nimport debounce from '../../utils/debounce';\n\nexport default class RouteSeeker extends Component {\n  static propTypes = {\n    videoLength: PropTypes.number.isRequired,\n    segmentIndices: PropTypes.arrayOf(PropTypes.number),\n    segment: PropTypes.arrayOf(PropTypes.number),\n    onUserSeek: PropTypes.func,\n    onPlaySeek: PropTypes.func,\n    video: PropTypes.node,\n    onPause: PropTypes.func,\n    onPlay: PropTypes.func,\n    playing: PropTypes.bool,\n    segmentProgress: PropTypes.func,\n    ratioTime: PropTypes.func,\n    nearestFrameTime: PropTypes.number\n  };\n\n  static hiddenMarkerStyle = { display: 'none', left: 0 };\n\n  static zeroSeekedBarStyle = { width: 0 };\n\n  static hiddenTooltipStyle = { display: 'none', left: 0 };\n\n  static markerWidth = 20;\n\n  static tooltipWidth = 50;\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      seekedBarStyle: RouteSeeker.zeroSeekedBarStyle,\n      markerStyle: RouteSeeker.hiddenMarkerStyle,\n      tooltipStyle: RouteSeeker.hiddenTooltipStyle,\n      ratio: 0,\n      tooltipTime: '0:00',\n      isPlaying: false,\n      isDragging: false\n    };\n\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseLeave = this.onMouseLeave.bind(this);\n    this.onMouseDown = this.onMouseDown.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onClick = this.onClick.bind(this);\n    this.onPlay = this.onPlay.bind(this);\n    this.onPause = this.onPause.bind(this);\n    this.executePlayTimer = this.executePlayTimer.bind(this);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (JSON.stringify(prevProps.segmentIndices) !== JSON.stringify(this.props.segmentIndices)) {\n      this.setState({\n        seekedBarStyle: RouteSeeker.zeroSeekedBarStyle,\n        markerStyle: RouteSeeker.hiddenMarkerStyle,\n        ratio: 0\n      });\n    } else if (this.props.videoLength && prevProps.videoLength !== this.props.videoLength) {\n      // adjust ratio in line with new videoLength\n      const secondsSeeked = this.state.ratio * prevProps.videoLength;\n      const newRatio = secondsSeeked / this.props.videoLength;\n      this.updateSeekedBar(newRatio);\n    }\n\n    if (prevProps.nearestFrameTime !== this.props.nearestFrameTime) {\n      const newRatio = this.props.segmentProgress(this.props.nearestFrameTime);\n      this.updateSeekedBar(newRatio);\n    }\n\n    if (prevProps.playing !== this.props.isPlaying) {\n      if (this.props.playing && !this.state.isPlaying) {\n        this.onPlay();\n      } else if (!this.props.playing && this.state.isPlaying) {\n        this.onPause();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    window.cancelAnimationFrame(this.playTimer);\n  }\n\n  mouseEventXOffsetPercent(e) {\n    const rect = this.progressBar.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n\n    return 100 * (x / this.progressBar.offsetWidth);\n  }\n\n  updateDraggingSeek = debounce((ratio) => this.props.onUserSeek(ratio), 250);\n\n  onMouseMove(e) {\n    const markerOffsetPct = this.mouseEventXOffsetPercent(e);\n    if (markerOffsetPct < 0) {\n      this.onMouseLeave();\n      return;\n    }\n    const { markerWidth } = RouteSeeker;\n\n    const markerLeft = `calc(${markerOffsetPct}% - ${markerWidth / 2}px)`;\n    const markerStyle = {\n      display: '',\n      left: markerLeft\n    };\n    const { tooltipWidth } = RouteSeeker;\n    const tooltipLeft = `calc(${markerOffsetPct}% - ${tooltipWidth / 2}px)`;\n\n    const tooltipStyle = { display: 'flex', left: tooltipLeft };\n    const ratio = Math.max(0, markerOffsetPct / 100);\n    if (this.state.isDragging) {\n      this.updateSeekedBar(ratio);\n      this.updateDraggingSeek(ratio);\n    }\n\n    this.setState({\n      markerStyle,\n      tooltipStyle,\n      tooltipTime: this.props.ratioTime(ratio).toFixed(3)\n    });\n  }\n\n  onMouseLeave(e) {\n    this.setState({\n      markerStyle: RouteSeeker.hiddenMarkerStyle,\n      tooltipStyle: RouteSeeker.hiddenTooltipStyle,\n      isDragging: false\n    });\n  }\n\n  updateSeekedBar(ratio) {\n    const seekedBarStyle = { width: `${100 * ratio}%` };\n    this.setState({ seekedBarStyle, ratio });\n  }\n\n  onClick(e) {\n    let ratio = this.mouseEventXOffsetPercent(e) / 100;\n    ratio = Math.min(1, Math.max(0, ratio));\n    this.updateSeekedBar(ratio);\n    this.props.onUserSeek(ratio);\n  }\n\n  onPlay() {\n    this.playTimer = window.requestAnimationFrame(this.executePlayTimer);\n    let { ratio } = this.state;\n    if (ratio >= 1) {\n      ratio = 0;\n    }\n    this.setState({ isPlaying: true, ratio });\n    this.props.onPlay();\n  }\n\n  executePlayTimer() {\n    const { videoElement } = this.props;\n    if (videoElement === null) {\n      this.playTimer = window.requestAnimationFrame(this.executePlayTimer);\n      return;\n    }\n\n    let { videoLength, startTime } = this.props;\n    let { currentTime } = videoElement;\n\n    currentTime = roundTime(currentTime);\n    startTime = roundTime(startTime);\n    videoLength = roundTime(videoLength);\n\n    let newRatio = (currentTime - startTime) / videoLength;\n\n    if (newRatio === this.state.ratio) {\n      this.playTimer = window.requestAnimationFrame(this.executePlayTimer);\n      return;\n    }\n\n    if ((newRatio >= 1 && this.props.segment && this.props.segment.length) || newRatio < 0) {\n      newRatio = 0;\n      currentTime = startTime;\n      this.props.onUserSeek(newRatio);\n    } else if (newRatio >= 1) {\n      videoElement.pause();\n      this.onPause();\n    }\n\n    if (newRatio >= 0) {\n      this.updateSeekedBar(newRatio);\n      this.props.onPlaySeek(currentTime);\n    }\n\n    this.playTimer = window.requestAnimationFrame(this.executePlayTimer);\n  }\n\n  onPause() {\n    window.cancelAnimationFrame(this.playTimer);\n    this.setState({ isPlaying: false });\n    this.props.onPause();\n  }\n\n  onMouseDown() {\n    if (!this.state.isDragging) {\n      this.setState({ isDragging: true });\n    }\n  }\n\n  onMouseUp() {\n    if (this.state.isDragging) {\n      this.setState({ isDragging: false });\n    }\n  }\n\n  render() {\n    const { seekedBarStyle, markerStyle, tooltipStyle } = this.state;\n    return (\n      <div className=\"cabana-explorer-visuals-camera-seeker\">\n        <PlayButton\n          className=\"cabana-explorer-visuals-camera-seeker-playbutton\"\n          onPlay={this.onPlay}\n          onPause={this.onPause}\n          isPlaying={this.state.isPlaying}\n        />\n        <div\n          className=\"cabana-explorer-visuals-camera-seeker-progress\"\n          onMouseMove={this.onMouseMove}\n          onMouseLeave={this.onMouseLeave}\n          onMouseDown={this.onMouseDown}\n          onMouseUp={this.onMouseUp}\n          onClick={this.onClick}\n          ref={(ref) => (this.progressBar = ref)}\n        >\n          <div\n            className=\"cabana-explorer-visuals-camera-seeker-progress-tooltip\"\n            style={tooltipStyle}\n          >\n            {this.state.tooltipTime}\n          </div>\n          <div\n            className=\"cabana-explorer-visuals-camera-seeker-progress-marker\"\n            style={markerStyle}\n          />\n          <div\n            className=\"cabana-explorer-visuals-camera-seeker-progress-inner\"\n            style={seekedBarStyle}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction roundTime(time) {\n  return Math.round(time * 1000) / 1000;\n}\n"]},"metadata":{},"sourceType":"module"}