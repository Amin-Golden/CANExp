{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getUploadUrls = undefined;\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar getUploadUrls = exports.getUploadUrls = function () {\n  var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(dongleId, paths, expiry) {\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return request.post('v1/' + dongleId + '/upload_urls/', {\n              paths: paths,\n              expiry_days: expiry\n            });\n\n          case 2:\n            return _context.abrupt('return', _context.sent);\n\n          case 3:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function getUploadUrls(_x3, _x4, _x5) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar getCached = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(endpoint, params, nocache) {\n    return _regenerator2.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            // don't bother bouncing because the URLs themselves expire\n            // our expiry time is from initial fetch time, not most recent access\n            if (params !== undefined) {\n              endpoint += '?' + _queryString2.default.stringify(params);\n            }\n\n            if (!(urlStore[endpoint] && !nocache)) {\n              _context2.next = 3;\n              break;\n            }\n\n            return _context2.abrupt('return', urlStore[endpoint]);\n\n          case 3:\n            _context2.next = 5;\n            return request.get(endpoint);\n\n          case 5:\n            urlStore[endpoint] = _context2.sent;\n            setTimeout(function () {\n              delete urlStore[endpoint];\n            }, 1000 * 60 * 45); // expires in 1h, lets reset in 45m\n\n            return _context2.abrupt('return', urlStore[endpoint]);\n\n          case 8:\n          case 'end':\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this);\n  }));\n\n  return function getCached(_x6, _x7, _x8) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.getRouteFiles = getRouteFiles;\nexports.getLogUrls = getLogUrls;\nexports.getUploadUrl = getUploadUrl;\n\nvar _queryString = require('query-string');\n\nvar _queryString2 = _interopRequireDefault(_queryString);\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar urlStore = {};\n\nfunction getRouteFiles(routeName) {\n  var nocache = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;\n  return getCached('v1/route/' + routeName + '/files', params, nocache);\n}\n\nfunction getLogUrls(routeName, params) {\n  return getCached('v1/route/' + routeName + '/log_urls', params);\n}\n\nfunction getUploadUrl(dongleId, path, expiry) {\n  return getCached('v1.4/' + dongleId + '/upload_url/', {\n    path: path,\n    expiry_days: expiry\n  });\n}","map":{"version":3,"sources":["/home/amax/Autoro/cabana/node_modules/@commaai/comma-api/dist/raw.js"],"names":["Object","defineProperty","exports","value","getUploadUrls","undefined","_regenerator","require","_regenerator2","_interopRequireDefault","_asyncToGenerator2","_asyncToGenerator3","_ref","default","mark","_callee","dongleId","paths","expiry","wrap","_callee$","_context","prev","next","request","post","expiry_days","abrupt","sent","stop","_x3","_x4","_x5","apply","arguments","getCached","_ref2","_callee2","endpoint","params","nocache","_callee2$","_context2","_queryString2","stringify","urlStore","get","setTimeout","_x6","_x7","_x8","getRouteFiles","getLogUrls","getUploadUrl","_queryString","_request","_interopRequireWildcard","obj","__esModule","newObj","key","prototype","hasOwnProperty","call","routeName","length","path"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,aAAR,GAAwBC,SAAxB;;AAEA,IAAIC,YAAY,GAAGC,OAAO,CAAC,2BAAD,CAA1B;;AAEA,IAAIC,aAAa,GAAGC,sBAAsB,CAACH,YAAD,CAA1C;;AAEA,IAAII,kBAAkB,GAAGH,OAAO,CAAC,wCAAD,CAAhC;;AAEA,IAAII,kBAAkB,GAAGF,sBAAsB,CAACC,kBAAD,CAA/C;;AAEA,IAAIN,aAAa,GAAGF,OAAO,CAACE,aAAR,GAAwB,YAAY;AACtD,MAAIQ,IAAI,GAAG,CAAC,GAAGD,kBAAkB,CAACE,OAAvB,GAAiC,aAAaL,aAAa,CAACK,OAAd,CAAsBC,IAAtB,CAA2B,SAASC,OAAT,CAAiBC,QAAjB,EAA2BC,KAA3B,EAAkCC,MAAlC,EAA0C;AAC5H,WAAOV,aAAa,CAACK,OAAd,CAAsBM,IAAtB,CAA2B,SAASC,QAAT,CAAkBC,QAAlB,EAA4B;AAC5D,aAAO,CAAP,EAAU;AACR,gBAAQA,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAACE,IAAjC;AACE,eAAK,CAAL;AACEF,YAAAA,QAAQ,CAACE,IAAT,GAAgB,CAAhB;AACA,mBAAOC,OAAO,CAACC,IAAR,CAAa,QAAQT,QAAR,GAAmB,eAAhC,EAAiD;AACtDC,cAAAA,KAAK,EAAEA,KAD+C;AAEtDS,cAAAA,WAAW,EAAER;AAFyC,aAAjD,CAAP;;AAKF,eAAK,CAAL;AACE,mBAAOG,QAAQ,CAACM,MAAT,CAAgB,QAAhB,EAA0BN,QAAQ,CAACO,IAAnC,CAAP;;AAEF,eAAK,CAAL;AACA,eAAK,KAAL;AACE,mBAAOP,QAAQ,CAACQ,IAAT,EAAP;AAbJ;AAeD;AACF,KAlBM,EAkBJd,OAlBI,EAkBK,IAlBL,CAAP;AAmBD,GApBwD,CAA9C,CAAX;;AAsBA,SAAO,SAASX,aAAT,CAAuB0B,GAAvB,EAA4BC,GAA5B,EAAiCC,GAAjC,EAAsC;AAC3C,WAAOpB,IAAI,CAACqB,KAAL,CAAW,IAAX,EAAiBC,SAAjB,CAAP;AACD,GAFD;AAGD,CA1B2C,EAA5C;;AA4BA,IAAIC,SAAS,GAAG,YAAY;AAC1B,MAAIC,KAAK,GAAG,CAAC,GAAGzB,kBAAkB,CAACE,OAAvB,GAAiC,aAAaL,aAAa,CAACK,OAAd,CAAsBC,IAAtB,CAA2B,SAASuB,QAAT,CAAkBC,QAAlB,EAA4BC,MAA5B,EAAoCC,OAApC,EAA6C;AAChI,WAAOhC,aAAa,CAACK,OAAd,CAAsBM,IAAtB,CAA2B,SAASsB,SAAT,CAAmBC,SAAnB,EAA8B;AAC9D,aAAO,CAAP,EAAU;AACR,gBAAQA,SAAS,CAACpB,IAAV,GAAiBoB,SAAS,CAACnB,IAAnC;AACE,eAAK,CAAL;AACE;AACA;AACA,gBAAIgB,MAAM,KAAKlC,SAAf,EAA0B;AACxBiC,cAAAA,QAAQ,IAAI,MAAMK,aAAa,CAAC9B,OAAd,CAAsB+B,SAAtB,CAAgCL,MAAhC,CAAlB;AACD;;AAED,gBAAI,EAAEM,QAAQ,CAACP,QAAD,CAAR,IAAsB,CAACE,OAAzB,CAAJ,EAAuC;AACrCE,cAAAA,SAAS,CAACnB,IAAV,GAAiB,CAAjB;AACA;AACD;;AAED,mBAAOmB,SAAS,CAACf,MAAV,CAAiB,QAAjB,EAA2BkB,QAAQ,CAACP,QAAD,CAAnC,CAAP;;AAEF,eAAK,CAAL;AACEI,YAAAA,SAAS,CAACnB,IAAV,GAAiB,CAAjB;AACA,mBAAOC,OAAO,CAACsB,GAAR,CAAYR,QAAZ,CAAP;;AAEF,eAAK,CAAL;AACEO,YAAAA,QAAQ,CAACP,QAAD,CAAR,GAAqBI,SAAS,CAACd,IAA/B;AAGAmB,YAAAA,UAAU,CAAC,YAAY;AACrB,qBAAOF,QAAQ,CAACP,QAAD,CAAf;AACD,aAFS,EAEP,OAAO,EAAP,GAAY,EAFL,CAAV,CAJF,CAMsB;;AAEpB,mBAAOI,SAAS,CAACf,MAAV,CAAiB,QAAjB,EAA2BkB,QAAQ,CAACP,QAAD,CAAnC,CAAP;;AAEF,eAAK,CAAL;AACA,eAAK,KAAL;AACE,mBAAOI,SAAS,CAACb,IAAV,EAAP;AA/BJ;AAiCD;AACF,KApCM,EAoCJQ,QApCI,EAoCM,IApCN,CAAP;AAqCD,GAtCyD,CAA9C,CAAZ;;AAwCA,SAAO,SAASF,SAAT,CAAmBa,GAAnB,EAAwBC,GAAxB,EAA6BC,GAA7B,EAAkC;AACvC,WAAOd,KAAK,CAACH,KAAN,CAAY,IAAZ,EAAkBC,SAAlB,CAAP;AACD,GAFD;AAGD,CA5Ce,EAAhB;;AA8CAhC,OAAO,CAACiD,aAAR,GAAwBA,aAAxB;AACAjD,OAAO,CAACkD,UAAR,GAAqBA,UAArB;AACAlD,OAAO,CAACmD,YAAR,GAAuBA,YAAvB;;AAEA,IAAIC,YAAY,GAAG/C,OAAO,CAAC,cAAD,CAA1B;;AAEA,IAAIoC,aAAa,GAAGlC,sBAAsB,CAAC6C,YAAD,CAA1C;;AAEA,IAAIC,QAAQ,GAAGhD,OAAO,CAAC,WAAD,CAAtB;;AAEA,IAAIiB,OAAO,GAAGgC,uBAAuB,CAACD,QAAD,CAArC;;AAEA,SAASC,uBAAT,CAAiCC,GAAjC,EAAsC;AAAE,MAAIA,GAAG,IAAIA,GAAG,CAACC,UAAf,EAA2B;AAAE,WAAOD,GAAP;AAAa,GAA1C,MAAgD;AAAE,QAAIE,MAAM,GAAG,EAAb;;AAAiB,QAAIF,GAAG,IAAI,IAAX,EAAiB;AAAE,WAAK,IAAIG,GAAT,IAAgBH,GAAhB,EAAqB;AAAE,YAAIzD,MAAM,CAAC6D,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCN,GAArC,EAA0CG,GAA1C,CAAJ,EAAoDD,MAAM,CAACC,GAAD,CAAN,GAAcH,GAAG,CAACG,GAAD,CAAjB;AAAyB;AAAE;;AAACD,IAAAA,MAAM,CAAC9C,OAAP,GAAiB4C,GAAjB;AAAsB,WAAOE,MAAP;AAAgB;AAAE;;AAE7Q,SAASlD,sBAAT,CAAgCgD,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAE5C,IAAAA,OAAO,EAAE4C;AAAX,GAArC;AAAwD;;AAE/F,IAAIZ,QAAQ,GAAG,EAAf;;AACA,SAASM,aAAT,CAAuBa,SAAvB,EAAkC;AAChC,MAAIxB,OAAO,GAAGN,SAAS,CAAC+B,MAAV,GAAmB,CAAnB,IAAwB/B,SAAS,CAAC,CAAD,CAAT,KAAiB7B,SAAzC,GAAqD6B,SAAS,CAAC,CAAD,CAA9D,GAAoE,KAAlF;AACA,MAAIK,MAAM,GAAGL,SAAS,CAAC+B,MAAV,GAAmB,CAAnB,IAAwB/B,SAAS,CAAC,CAAD,CAAT,KAAiB7B,SAAzC,GAAqD6B,SAAS,CAAC,CAAD,CAA9D,GAAoE7B,SAAjF;AAEA,SAAO8B,SAAS,CAAC,cAAc6B,SAAd,GAA0B,QAA3B,EAAqCzB,MAArC,EAA6CC,OAA7C,CAAhB;AACD;;AAED,SAASY,UAAT,CAAoBY,SAApB,EAA+BzB,MAA/B,EAAuC;AACrC,SAAOJ,SAAS,CAAC,cAAc6B,SAAd,GAA0B,WAA3B,EAAwCzB,MAAxC,CAAhB;AACD;;AAED,SAASc,YAAT,CAAsBrC,QAAtB,EAAgCkD,IAAhC,EAAsChD,MAAtC,EAA8C;AAC5C,SAAOiB,SAAS,CAAC,UAAUnB,QAAV,GAAqB,cAAtB,EAAsC;AACpDkD,IAAAA,IAAI,EAAEA,IAD8C;AAEpDxC,IAAAA,WAAW,EAAER;AAFuC,GAAtC,CAAhB;AAID","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getUploadUrls = undefined;\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar getUploadUrls = exports.getUploadUrls = function () {\n  var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(dongleId, paths, expiry) {\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return request.post('v1/' + dongleId + '/upload_urls/', {\n              paths: paths,\n              expiry_days: expiry\n            });\n\n          case 2:\n            return _context.abrupt('return', _context.sent);\n\n          case 3:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function getUploadUrls(_x3, _x4, _x5) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar getCached = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(endpoint, params, nocache) {\n    return _regenerator2.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            // don't bother bouncing because the URLs themselves expire\n            // our expiry time is from initial fetch time, not most recent access\n            if (params !== undefined) {\n              endpoint += '?' + _queryString2.default.stringify(params);\n            }\n\n            if (!(urlStore[endpoint] && !nocache)) {\n              _context2.next = 3;\n              break;\n            }\n\n            return _context2.abrupt('return', urlStore[endpoint]);\n\n          case 3:\n            _context2.next = 5;\n            return request.get(endpoint);\n\n          case 5:\n            urlStore[endpoint] = _context2.sent;\n\n\n            setTimeout(function () {\n              delete urlStore[endpoint];\n            }, 1000 * 60 * 45); // expires in 1h, lets reset in 45m\n\n            return _context2.abrupt('return', urlStore[endpoint]);\n\n          case 8:\n          case 'end':\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this);\n  }));\n\n  return function getCached(_x6, _x7, _x8) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.getRouteFiles = getRouteFiles;\nexports.getLogUrls = getLogUrls;\nexports.getUploadUrl = getUploadUrl;\n\nvar _queryString = require('query-string');\n\nvar _queryString2 = _interopRequireDefault(_queryString);\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar urlStore = {};\nfunction getRouteFiles(routeName) {\n  var nocache = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;\n\n  return getCached('v1/route/' + routeName + '/files', params, nocache);\n}\n\nfunction getLogUrls(routeName, params) {\n  return getCached('v1/route/' + routeName + '/log_urls', params);\n}\n\nfunction getUploadUrl(dongleId, path, expiry) {\n  return getCached('v1.4/' + dongleId + '/upload_url/', {\n    path: path,\n    expiry_days: expiry\n  });\n}"]},"metadata":{},"sourceType":"script"}